[Interface]
PrivateKey = {{ server_private_key.stdout }}
Address = {{ wg_ip_pool_part }}.1/24
ListenPort = {{ wg_port }}
PostUp = iptables -t nat -I POSTROUTING 1 -s {{ wg_ip_pool_part }}.0/24 -m comment --comment "wg nat" -j MASQUERADE
PostUp = iptables -A FORWARD -i {{ ansible_default_ipv4.interface }} -o {{ wg_interface }} -m comment --comment "wg forward" -j ACCEPT
PostUp = iptables -A FORWARD -i {{ wg_interface }} -o {{ ansible_default_ipv4.interface }}  -m comment --comment "wg forward" -j ACCEPT
PostUp = iptables -I INPUT A -p udp --dport {{ wg_port }} -m conntrack --ctstate NEW,ESTABLISHED -m comment --comment "wg from external" -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -s {{ wg_ip_pool_part }}.0/24 -m comment --comment "wg nat" -j MASQUERADE
PostDown = iptables -D FORWARD -i {{ ansible_default_ipv4.interface }} -o {{ wg_interface }} -m comment --comment "wg forward" -j ACCEPT
PostDown = iptables -D FORWARD -i {{ wg_interface }} -o {{ ansible_default_ipv4.interface }}  -m comment --comment "wg forward" -j ACCEPT
PostDown = iptables -D INPUT -p udp --dport {{ wg_port }} -m conntrack --ctstate NEW,ESTABLISHED -m comment --comment "wg from external" -j ACCEPT
SaveConfig = false
